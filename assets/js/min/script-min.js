function setup(){makeTextEditable(),setThreshold(),updateSaturation(),updateLightness(),updateSVG(),setBackgroundColor(),setTextColor(),$(":input").each(function(){var t=$(this).val();$(this).attr("data-value",t)}),sizeSVG()}function makeTextEditable(){$(".text_container").empty();var t=$("svg text"),e=t.length,a=0;$("svg text").each(function(){var t=$(this).find("tspan").attr("font-size"),e=$(this).find("tspan:nth-of-type(2)").attr("y");null==e&&(e=1.5*t);var i=$(this).find("tspan").attr("font-family"),n=$(this).find("tspan").attr("font-style"),r=$(this).attr("transform");r=r.split(" ");var l=r[4].replace(/[^\w\s\.]/gi,""),o=r[5].replace(/[^\w\s\.]/gi,""),s="dynamicText_"+a;$(this).attr("class",s);var c="dynamicTextSource_"+a;$(".text_container").append('<div class="'+c+' textelement"></div>'),$("."+c).append('<textarea class="text dynamicTextSourceInput_'+a+'" data-target="'+s+'" onkeyup="writeText();" data-numElement="'+a+'"></textarea>'),$("."+c).append('<label for="'+c+'_fontsize">Font Size: </label><input type="number" name="" class="fontsize" id="'+c+'_fontsize" value="'+t+'" onchange="writeText();"><br><br>'),$("."+c).append('<label for="'+c+'_lineheight">Line Height: </label><input type="number" name="" class="lineheight" id="'+c+'_lineheight" value="'+e+'" onchange="writeText();"><br><br>'),$("."+c).append('<label for="'+c+'_lineheight">Font Family: </label><select class="fontfamily" name="" id="'+c+'_fontfamily" onchange="writeText();"><option value="'+i+'">Default: '+i+"</option><option value=\"'Futura-Medium'\">'Futura-Medium'</option><option value=\"Georgia\">Georgia</option></select><br><br>"),$("."+c).append('<label for="'+c+'_fontstyle">Font Style: </label><select class="fontstyle" name="" id="'+c+'_fontstyle" onchange="writeText();"><option value="'+n+'">Default: '+n+'</option><option value="normal">Normal</option><option value="italic">Italic</option></select><br><br>'),$("."+c).append('<label for="'+c+'_xPos">X Positioning: </label><input type="range" min="0" max="'+svgWidth+'" step="1" data-value="" name="" class="xpositioning" id="'+c+'_xpositioning" value="'+l+'" onmousemove="updateRangeValue(); positionTextInSVG();"><br><br>'),$("."+c).append('<label for="'+c+'_xPos">Y Positioning: </label><input type="range" min="0" max="'+svgHeight+'" step="1" data-value="" name="" class="ypositioning" id="'+c+'_ypositioning" value="'+o+'" onmousemove="updateRangeValue(); positionTextInSVG();"><br><br>'),$(".text_container").append("<hr>"),$(this).find("tspan").each(function(){var t=$(this).text();$(".dynamicTextSourceInput_"+a).append(t+"\n")}),a++})}function writeText(){$("textarea.text").each(function(){var t=$(this).attr("data-numElement"),e="dynamicTextSource_"+t,a=$(this).attr("data-target"),i=$("#"+e+"_fontsize").val(),n=$("#"+e+"_lineheight").val(),r=$("#"+e+"_fontfamily").val(),l=$("#"+e+"_fontstyle").val(),o=$(this).val().split("\n");$("svg ."+a).find("tspan").remove();for(var s=0;s<o.length;s++){var c=n*s,d=document.createElementNS("http://www.w3.org/2000/svg","tspan"),u=d3.select(d);u.text(o[s]).attr("class",s).attr("x",0).attr("y",c).attr("font-family",r).attr("font-size",i).attr("font-style",l),$("svg ."+a).append(d)}})}function positionTextInSVG(){$("svg text").each(function(){var t=$(this).attr("class");t=t.replace("dynamicText_","");var e=$("#dynamicTextSource_"+t+"_xpositioning").val(),a=$("#dynamicTextSource_"+t+"_ypositioning").val();$(this).attr("transform","matrix(1 0 0 1 "+e+" "+a+")")})}function addTextToSVG(){d3.select("svg").append("g").attr("class","text draggable").append("text").attr("transform","matrix(1 0 0 1 20 40)").append("tspan").text("New Text").attr("class",0).attr("x",0).attr("y",0).attr("font-family",defaultfont).attr("font-size",defaultfontsize),makeTextEditable()}function sizeSVG(){var t=window.innerHeight/100*svgDisplayHeight-100,e=t/svgAspectRatio;$(".svg-wrap").attr("style","width: "+e+"px; height: "+t+"px")}function loadSvg(t){var e=$(".svg-wrap");if("undefined"!=typeof SVGRect){var a=new XMLHttpRequest;a.open("GET",t,!0),a.send(),a.onload=function(t){$(".svg-wrap").html(a.responseText),setup()}}else alert("Sorry, I couldn't load the file, please try a different file.")}function renderImage(t){var e=new FileReader;e.onload=function(t){the_url=t.target.result,svgAspectRatio=svgWidth/svgHeight,$(".backgroundimagecontainer").html("<img src='"+the_url+"' class='backgroundimage'/>");var e=$(".backgroundimage").width(),a=$(".backgroundimage").height(),i=100,n=0,r=0,l,o,s=e/a;$("svg #background_image").attr("xlink:href",""),e>a?(l=svgHeight*s,o=svgHeight,$("svg #background_image").attr("xlink:href",the_url).attr("width",l).attr("height",o)):(s>svgAspectRatio?(l=svgHeight*s,o=svgHeight):(l=svgWidth,o=svgWidth/s),$("svg #background_image").attr("xlink:href",the_url).attr("width",l).attr("height",o)),setBackgroundAlpha(.35)},e.readAsDataURL(t)}function updateDynamicColorRange(){var t=$(".saturationslider").val(),e=$(".lightnessslider").val(),a=$(".alphaslider").val(),i="linear-gradient(to right, hsla(0, "+t+"%, "+e+"%, "+a+") 0%, hsla(60, "+t+"%, "+e+"%, "+a+") 16%, hsla(120, "+t+"%, "+e+"%, "+a+") 32%, hsla(180, "+t+"%, "+e+"%, "+a+") 50%, hsla(240, "+t+"%, "+e+"%, "+a+") 68%, hsla(300, "+t+"%, "+e+"%, "+a+") 84%, hsla(360, "+t+"%, "+e+"%, "+a+") 100%);";$(".colorrange_dynamic").attr("style","background: "+i)}function randomSVGElement(t){var e=randomColor(),a=Math.random();return"required"==t?fill=textcolor:"hidden"==t?fill="none":"visible"==t?fill=e:threshold>a?fill=e:fill="none",fill}function updateSVGColors(){$("svg circle").each(function(){var t=$(this).attr("fill");"none"!=t&&$(this).attr("fill",randomColor())}),$("svg path").each(function(){var t=$(this).attr("fill");"none"!=t&&$(this).attr("fill",randomColor())}),$("svg rect").each(function(){var t=$(this).attr("fill");"none"!=t&&$(this).attr("fill",randomColor())}),$("svg polygon").each(function(){var t=$(this).attr("fill");"none"!=t&&$(this).attr("fill",randomColor())}),setBackgroundColor(),setTextColor()}function randomizeSVGColors(){$("svg circle").each(function(){var t=$(this).attr("fill");"none"!=t&&$(this).attr("fill",randomColor())}),$("svg path").each(function(){var t=$(this).attr("fill");"none"!=t&&$(this).attr("fill",randomColor())}),$("svg rect").each(function(){var t=$(this).attr("fill");"none"!=t&&$(this).attr("fill",randomColor())}),$("svg polygon").each(function(){var t=$(this).attr("fill");"none"!=t&&$(this).attr("fill",randomColor())}),setTextColor();var t=$("#svg_x5F_background").attr("fill"),e=chroma(t).hsl();$(".bg_hue").attr("value",e[0]).attr("data-value",e[0]),$(".bg_saturation").attr("value",100*e[1]).attr("data-value",100*e[1]),$(".bg_lightness").attr("value",100*e[2]).attr("data-value",100*e[2])}function updateSVG(){$("svg circle").each(function(){if("hidden"==$(this).attr("data-visibility"))var t=randomSVGElement("hidden");else if("visible"==$(this).attr("data-visibility"))var t=randomSVGElement("visible");else var t=randomSVGElement();$(this).attr("fill",t),$(this).attr("fill-opacity",alpha)}),$("svg path").each(function(){if("hidden"==$(this).attr("data-visibility"))var t=randomSVGElement("hidden");else if("visible"==$(this).attr("data-visibility"))var t=randomSVGElement("visible");else var t=randomSVGElement();$(this).attr("fill",t),$(this).attr("fill-opacity",alpha)}),$("svg rect").each(function(){if("hidden"==$(this).attr("data-visibility"))var t=randomSVGElement("hidden");else if("visible"==$(this).attr("data-visibility"))var t=randomSVGElement("visible");else var t=randomSVGElement();$(this).attr("fill",t),$(this).attr("fill-opacity",alpha)}),$("svg polygon").each(function(){if("hidden"==$(this).attr("data-visibility"))var t=randomSVGElement("hidden");else if("visible"==$(this).attr("data-visibility"))var t=randomSVGElement("visible");else var t=randomSVGElement();$(this).attr("fill",t),$(this).attr("fill-opacity",alpha)}),$("svg #Logo *").each(function(){var t=randomSVGElement("required");$(this).attr("fill",t),$(this).attr("fill-opacity",alpha)}),setBackgroundColor(),setTextColor()}function setTextColor(){var t=$(".text_hue").val(),e=$(".text_saturation").val(),a=$(".text_lightness").val(),i=$(".text_alpha").val(),n="hsla("+t+", "+e+"%, "+a+"%, "+i+")";$(".text_color_preview").css("background-color",n),n="hsl("+t+", "+e+"%, "+a+"%)",n=chroma(n).hex(),$("svg text").each(function(){$(this).attr("fill",n).attr("fill-opacity",i)}),$("svg #Logo *").each(function(){$(this).attr("fill",n).attr("fill-opacity",i)})}function setBackgroundColor(){var t=$(".bg_hue").val(),e=$(".bg_saturation").val(),a=$(".bg_lightness").val(),i=$(".bg_alpha").val(),n="hsla("+t+", "+e+"%, "+a+"%, "+i+")";$(".bg_color_preview").css("background-color",n),n="hsl("+t+", "+e+"%, "+a+"%)",n=chroma(n).hex(),$("svg #svg_x5F_background").attr("fill",n).attr("fill-opacity",i)}function setBackgroundAlpha(t){$(".bg_alpha").val(t).attr("data-value",t),setBackgroundColor()}function updateRangeValue(){$("[type=range]").each(function(){var t=$(this).val();$(this).attr("data-value",t)})}function setThreshold(){$(".threshold").val(threshold)}function setThresholdToValue(t){threshold=t}function refreshThreshold(){threshold=$(".threshold").val()}function setSaturation(t){saturation=t?t:$(".saturationslider").val()}function updateSaturation(t){t?$(".saturationslider").val(t):(t=saturation,$(".saturationslider").val(t))}function setLightness(t){lightness=t?t:$(".lightnessslider").val()}function updateLightness(t){t?$(".lightnessslider").val(t):(t=saturation,$(".lightnessslider").val(t))}function setAlpha(t){alpha=t?t:$(".alphaslider").val()}function randomhue(){var t=$(".hue_min").val(),e=$(".hue_max").val();if(t=parseFloat(t),e=parseFloat(e),e>t)var a=e-t,i=t+a*Math.random();else var a=t-e,i=e+a*Math.random();return i}function randomColor(){var t=$(".hue_min").val(),e=$(".hue_max").val(),a=randomhue(t,e);lightness=$(".lightnessslider").val(),saturation=$(".saturationslider").val();var i="hsl("+Math.round(a)+", "+saturation+"%, "+lightness+"%)";i=chroma(i).hex();var n="";return i}function removeDragging(){var t=document.getElementsByClassName("dragging");for(i=0;i<t.length;i++)t[i].classList.remove("dragging")}function selectElement(t){selectedElement=t.target,selectedElement=selectedElement.parentNode,selectedElement=selectedElement.parentNode,t.preventDefault(),currentX=t.clientX,currentY=t.clientY,currentMatrix=selectedElement.getAttributeNS(null,"transform").slice(7,-1).split(" ");for(var e=0;e<currentMatrix.length;e++)currentMatrix[e]=parseFloat(currentMatrix[e]);selectedElement.setAttributeNS(null,"onmousemove","moveElement(evt)"),selectedElement.setAttributeNS(null,"onmouseout","deselectElement(evt)"),selectedElement.setAttributeNS(null,"onmouseup","deselectElement(evt)")}function moveElement(t,e){switch(t){case 1:t=t.parentNode;break;case 2:t=t.parentNode,t=t.parentNode;break;default:t=t}dx=t.clientX-currentX,dy=t.clientY-currentY,currentMatrix[4]+=dx,currentMatrix[5]+=dy,newMatrix="matrix("+currentMatrix.join(" ")+")",selectedElement.setAttributeNS(null,"transform",newMatrix),currentX=t.clientX,currentY=t.clientY}function deselectElement(t){0!=selectedElement&&(selectedElement.removeAttributeNS(null,"onmousemove"),selectedElement.removeAttributeNS(null,"onmouseup"),selectedElement=0)}var threshold=.2,saturation="75",lightness="70",textcolor="#000",alpha=1,svgAspectRatio=1.414285714,svgWidth=595.3,svgHeight=841.9,svgDisplayHeight=100,defaultfont="Futura-Medium",defaultfontsize=20;window.onload=function(){loadSvg("/sources/A4Poster.svg")},window.onresize=sizeSVG,$(".addNewText").click(function(){addTextToSVG()}),"undefined"==typeof escapeHtmlEntities&&(escapeHtmlEntities=function(t){return t.replace(/[\u00A0-\u2666<>\&]/g,function(t){var e="&#x"+t.charCodeAt(0)+";";return e})}),$(".choose_format").change(function(){$(".svg-wrap").html("");var t=$(this).attr("data-source");svgWidth=$(this).attr("data-width"),svgHeight=$(this).attr("data-Height"),svgDisplayHeight=$(this).attr("data-display-height"),svgAspectRatio=svgHeight/svgWidth,loadSvg(t)}),$(".applyfilter").click(function(){var t=$(this).attr("data-target");t=$("svg ").find(t),console.log(t);var e=$(this).attr("data-filter");console.log(e),e=this.checked?"url(#"+e+")":"",t.attr("filter",e)}),$("#the-file-input").change(function(){console.log(this.files),renderImage(this.files[0])}),$(".update").click(function(){setThreshold(),setSaturation(),setLightness(),setAlpha(),updateSVG()}),$(".saturationslider").change(function(){updateDynamicColorRange(),updateSVGColors()}),$(".saturationslider").mousemove(function(){updateDynamicColorRange(),updateSVGColors()}),$(".lightnessslider").change(function(){updateDynamicColorRange(),updateSVGColors()}),$(".lightnessslider").mousemove(function(){updateDynamicColorRange(),updateSVGColors()}),$(".alphaslider").change(function(){updateDynamicColorRange(),setAlpha(),updateSVGColors()}),$(".hue_min").change(function(){updateSVGColors()}),$(".hue_max").change(function(){updateSVGColors()}),$(".refresh_colors").click(function(){updateDynamicColorRange(),updateSVGColors()}),$(".randomize_colors").click(function(){updateDynamicColorRange(),randomizeSVGColors()}),$(".thresholdslider").change(function(){var t=$(this).val();setThresholdToValue(t),updateSVG()}),$(".text_color").change(function(){setTextColor()}),$(".bg_color").change(function(){setBackgroundColor()}),$(".bgimg_opacity").change(function(){var t=$(".bgimg_opacity").val();$(".backgroundimage").css("opacity",t),$("svg #background_image").attr("opacity",t)}),$(".text").change(function(){updateText()}),$(":input").mousedown(function(t,e){$(this).addClass("dragging")}),$(":input").mousemove(function(t,e){updateRangeValue()}),$(":input").mouseup(function(t,e){$(this).removeClass("dragging")}),$("#show_headline_bg").click(function(){var t=$("svg .headline").attr("data-visibility");"hidden"==t?$("svg rect.headline").attr("data-visibility","visible").attr("fill",randomColor).attr("fill-opacity",alpha):$("svg rect.headline").attr("data-visibility","hidden").attr("fill","none")}),$("#show_subtitle_bg").click(function(){var t=$("svg .subtitle").attr("data-visibility");"hidden"==t?$("svg rect.subtitle").attr("data-visibility","visible").attr("fill",randomColor).attr("fill-opacity",alpha):$("svg rect.subtitle").attr("data-visibility","hidden").attr("fill","none")}),$("#show_description_bg").click(function(){var t=$("svg .description").attr("data-visibility");"hidden"==t?$("svg rect.description").attr("data-visibility","visible").attr("fill",randomColor).attr("fill-opacity",alpha):$("svg rect.description").attr("data-visibility","hidden").attr("fill","none")}),$(".download").click(function(){var t=d3.select("svg#A4poster").attr("title","test2").attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;$("#svgcache").append(t),$("#svgcache svg").attr("id","generatedSVG"),$("#svgcache svg *").each(function(){var t=$(this).attr("fill");console.log(t),"none"==t&&$(this).remove()});var e=d3.select("svg#generatedSVG").attr("title","test2").attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;d3.select(".resultscontainer").append("div").attr("class","download").append("img").attr("src","data:image/svg+xml;base64,"+btoa(e)).attr("width","210").attr("height","297"),$("#svgcache svg").remove(),$(".tab_4").attr("checked","checked")}),$("svg *").mousedown(function(t){var e=t.target,a=e.classList.contains("draggable"),i=e.parentNode.classList.contains("draggable"),n=e.parentNode.parentNode.classList.contains("draggable");if(removeDragging(),a){var e=t.target;e.classList.add("dragging"),moveElement(t,0)}else if(i){var e=t.target,r=e.parentNode;r.classList.add("dragging"),moveElement(t,1)}else if(n){var e=t.target,r=e.parentNode,l=r.parentNode;l.classList.add("dragging"),moveElement(t,2)}dx=t.clientX-currentX,dy=t.clientY-currentY,currentMatrix[4]+=dx,currentMatrix[5]+=dy,newMatrix="matrix("+currentMatrix.join(" ")+")",selectedElement.setAttributeNS(null,"transform",newMatrix),currentX=t.clientX,currentY=t.clientY}),$(window).mouseup(function(){removeDragging()});var selectedElement=0,currentX=0,currentY=0,currentMatrix=0;